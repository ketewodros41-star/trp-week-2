# Final Architecture Report: The Automaton Auditor
**Week 2 — FDE Challenge: The Automaton Auditor**

---

## Executive Summary

The Automaton Auditor is a production-grade autonomous governance system built on LangGraph. It implements a hierarchical "Digital Courtroom" that ingests a GitHub repository URL and a PDF architectural report, then produces a structured audit verdict via forensic evidence collection, dialectical judicial reasoning, and deterministic synthesis.

**Overall Self-Audit Score:** _(Generated by running the agent against own repo — see `audit/report_onself_generated/report.md`)_

---

## Architecture Deep Dive

### Dialectical Synthesis

Dialectical synthesis is the core reasoning innovation of this system. Rather than using a single LLM as a generic "Grader," the system forces structured disagreement by instantiating three parallel judicial personas from the same evidence pool:

- **Prosecutor** — adversarial lens: scrutinizes for gaps, security violations, and vibe coding
- **Defense Attorney** — optimistic lens: rewards effort, intent, and spirit-of-the-law thinking
- **Tech Lead** — pragmatic lens: evaluates maintainability, architectural soundness, and viability

These three judges run concurrently via LangGraph's fan-out pattern. The `ChiefJusticeNode` then applies **deterministic Python if/else rules** (not another LLM) to resolve the resulting conflicts:

1. **Rule of Security**: Confirmed security flags (os.system, unsanitized inputs) cap the score at 3 regardless of Defense arguments.
2. **Rule of Evidence (Fact Supremacy)**: If the Defense claims "Deep Metacognition" but Detective evidence shows the PDF is missing, the Defense is overruled for hallucination.
3. **Rule of Functionality**: For architecture dimensions, the Tech Lead's score carries double weight.
4. **Dissent Requirement**: Any criterion with score variance > 2 generates an explicit dissent summary.

### Fan-In / Fan-Out Architecture

The graph implements **two distinct parallel fan-out/fan-in layers**:

```
START
  ├── [Detective Fan-Out] ─────────────────────────────┐
  │     ├── RepoInvestigator (AST, git log)             │
  │     ├── DocAnalyst (PDF RAG-lite)                   ├──> EvidenceAggregator (Fan-In + Cross-Ref)
  │     └── VisionInspector (diagram classification)    │
  └──────────────────────────────────────────────────── ┘
                                 │
                        [Judicial Fan-Out] ─────────────┐
                              ├── Prosecutor             │
                              ├── Defense                ├──> ChiefJustice (Fan-In + Synthesis)
                              └── TechLead               │
                        ─────────────────────────────── ┘
                                                         │
                                                       END
```

This architecture prevents the sequential execution bottleneck that would form if detectives ran one after another. LangGraph's `operator.ior` and `operator.add` reducers ensure that parallel branches write to the shared state without data loss or overwrites.

### Metacognition

The system exhibits metacognition via the `EvidenceAggregator` node, which performs **cross-reference validation**: it compares file paths claimed in the PDF report against actual files found by the `RepoInvestigator`. This is the system evaluating the quality of its own evidence — catching hallucinations before they influence the judicial layer.

### State Synchronization

The `AgentState` TypedDict uses `Annotated` type hints with `operator.ior` (dict merge) for `evidences` and `operator.add` (list append) for `opinions`. This ensures that when three detectives write simultaneously to `AgentState["evidences"]`, the results are merged correctly rather than one branch overwriting another.

---

## Architectural Diagrams

> _(See `reports/interim_report.md` for the StateGraph flow Mermaid diagram)_

---

## Criterion-by-Criterion Self-Audit

> _(Generated by running `uv run python src/graph.py --repo-url <own-repo-url> --pdf-path reports/final_report.pdf`)_
> 
> See: `audit/report_onself_generated/report.md`

---

## MinMax Feedback Loop Reflection

This section will be completed after peer exchange:

- **What your peer's agent caught:** _(To be completed after receiving peer report in `audit/report_bypeer_received/`)_
- **How you updated your agent:** _(To be completed after peer review cycle)_
- **Agent improvements made:** _(To be documented)_

---

## Remediation Plan for Remaining Gaps

| Gap | File | Action |
|---|---|---|
| VisionInspector execution | `src/tools/vision_tools.py` | Integrate PyMuPDF + Gemini Vision API for real diagram analysis |
| PDF → report.pdf conversion | `reports/` | Convert final_report.md to PDF using pandoc or a PDF library |
| Peer audit execution | `audit/report_onpeer_generated/` | Run agent against assigned peer's repo URL |
